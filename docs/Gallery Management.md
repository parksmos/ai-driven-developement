## 갤러리 관리 및 커뮤니티 공유 화면 기능명세서

---

### 프론트엔드 기능명세서

#### 1. 화면 레이아웃 및 디자인 명세

- **파일 위치**: `app/gallery/page.tsx`

1. **갤러리 상단 섹션**
   - **UI 구성**: 상단에 배치된 갤러리 제목과 필터/정렬 컨트롤 영역으로, ShadCN의 컴포넌트를 사용합니다.
   - **상호작용**: 
     - 필터 드롭다운에서 카테고리별, 날짜별, 태그별 필터링 가능
     - 정렬 드롭다운에서 최신순, 오래된순, 이름 (A-Z, Z-A) 등으로 정렬 가능
     - 필터 영역 토글 버튼으로 필터 섹션을 숨기거나 표시 가능
   - **디자인**: 
     - 제목: 격자형(Grid) 레이아웃으로 "이미지 갤러리" 표시
     - 필터/정렬 컨트롤: 접을 수 있는 Card 컴포넌트 내에 배치

2. **카테고리 관리 섹션**
   - **UI 구성**: 상단 컨트롤 영역의 "카테고리 관리" 버튼과 카테고리 선택 드롭다운 형태로 구현
   - **상호작용**: 
     - 카테고리 드롭다운 선택 시 해당 카테고리의 이미지만 필터링하여 표시
     - '카테고리 관리' 버튼 클릭 시 모달 창이 열려 카테고리 생성/수정/삭제 가능
   - **디자인**:
     - 카테고리 드롭다운: ShadCN의 `Select` 컴포넌트 사용
     - 카테고리 필터: 필터 섹션에 통합하여 배치

3. **갤러리 그리드 영역**
   - **UI 구성**: 중앙 영역에 표시되는 이미지 그리드로, 반응형 그리드 레이아웃을 사용합니다.
   - **상호작용**:
     - 각 이미지 카드 호버 시 자연스러운 확대 효과
     - 이미지 클릭 시 상세 보기 모달 열림
     - 체크박스로 다중 선택 기능 지원 (선택 모드 활성화 시)
     - 그리드/리스트 뷰 전환 지원 (컴팩트 모드와 일반 모드)
   - **디자인**:
     - 그리드: 화면 크기에 따라 열 수가 자동 조정되는 반응형 그리드 레이아웃
     - 이미지 카드: 썸네일, 제목, 생성일, 카테고리, 태그 정보 표시
     - 빈 상태: 이미지가 없을 경우 "해당 조건에 맞는 이미지가 없습니다" 메시지 표시

4. **이미지 상세 모달**
   - **파일 위치**: `components/ImageDetailModal.tsx`
   - **UI 구성**:
     - 모달 헤더: 이미지 제목과 닫기 버튼
     - 이미지 영역: 왼쪽 컬럼에 큰 이미지 표시
     - 정보 영역: 오른쪽 컬럼에 메타데이터 표시
     - 액션 버튼: 다운로드, 커뮤니티 공유, 삭제 버튼
     - 세부 정보: 프롬프트, 스타일 옵션, 생성 일시, 카테고리, 태그 정보
   - **상호작용**:
     - 태그 추가/제거: 폼을 통해 새 태그 추가, 기존 태그 제거
     - 카테고리 관리: 카테고리 배지를 클릭하여 이미지의 카테고리 할당/제거
     - 공유/다운로드/삭제: 해당 액션 버튼을 클릭하여 즉시 실행
   - **디자인**:
     - 모달 배경: 흰색(#FFFFFF) 배경에 그림자 효과
     - 정보 카드: 각 정보 섹션이 Card 컴포넌트로 구분하여 표시
     - 액션 버튼: 다운로드(outline), 공유(default), 삭제(destructive) 스타일로 구분

5. **카테고리 관리 모달**
   - **파일 위치**: `components/CategoryModal.tsx`
   - **UI 구성**:
     - 모달 헤더: "카테고리 관리" 제목과 닫기 버튼
     - 새 카테고리 섹션: 카테고리명 입력 필드와 추가 버튼
     - 카테고리 목록: 기존 카테고리 목록과 각각 편집/삭제 버튼
   - **상호작용**:
     - 카테고리 추가: 이름 입력 후 추가 버튼 클릭
     - 카테고리 편집: 편집 아이콘 클릭 시 인라인 편집 모드 전환
     - 카테고리 삭제: 삭제 아이콘 클릭 시 확인 절차 후 삭제
   - **디자인**:
     - 카테고리 항목: 배경색이 있는 개별 항목으로 표시
     - 편집/삭제 버튼: 작은 아이콘 버튼으로 우측 정렬
     - 보호된 카테고리: '전체'와 '미분류' 카테고리는 편집/삭제 불가

6. **커뮤니티 공유 모달**
   - **파일 위치**: `components/ShareModal.tsx`
   - **UI 구성**:
     - 모달 헤더: "커뮤니티에 공유하기" 제목과 닫기 버튼
     - 이미지 미리보기: 상단에 공유할 이미지 썸네일 표시
     - 입력 필드: 제목(필수), 설명, 태그 입력 영역
     - 공개 설정: 전체 공개/친구 공개 옵션 선택 라디오 버튼
     - 공유 버튼: 하단에 메인 색상의 큰 버튼
   - **상호작용**:
     - 자동 채우기: 갤러리 이미지의 태그가 자동으로 입력됨
     - 태그 관리: 엔터키 또는 쉼표로 태그 추가, 각 태그 옆 'x' 버튼으로 삭제
     - 공유 버튼 클릭 시 API 호출 후 성공/실패 알림 표시
   - **디자인**:
     - 입력 필드: 테두리가 있는 깔끔한 디자인
     - 태그: 배지 형태로 표시, 추가된 태그는 secondary 스타일
     - 공유 버튼: 메인 색상 배경에 Share2 아이콘 포함

7. **일괄 관리 도구바**
   - **UI 구성**: 선택 모드 활성화 및 이미지 선택 시 화면 하단에 나타나는 도구바
   - **상호작용**:
     - 선택 모드 토글: 상단 버튼으로 선택 모드 활성화/비활성화
     - 카테고리 이동: 선택된 이미지들을 특정 카테고리로 일괄 이동
     - 태그 추가: 선택된 이미지들에 동일한 태그 일괄 추가
     - 삭제: 선택된 이미지들 일괄 삭제
   - **디자인**:
     - 위치: 화면 하단 고정 위치
     - 컨트롤: 카테고리 선택, 태그 입력, 삭제 버튼 포함

#### 2. 사용자 흐름 및 상호작용

1. **갤러리 화면 진입**
   - 메인 화면의 네비게이션 메뉴에서 "갤러리" 링크를 클릭하여 진입합니다.
   - 페이지 로드 시 사용자의 저장된 이미지를 자동으로 불러와 그리드로 표시합니다.
   - 초기 상태에서는 최신순으로 정렬된 모든 이미지가 표시됩니다.

2. **카테고리 관리**
   - 필터 영역에서 카테고리를 선택하여 해당 카테고리의 이미지만 필터링해 볼 수 있습니다.
   - "카테고리 관리" 버튼을 클릭하여 카테고리 관리 모달을 열 수 있습니다.
   - 카테고리 관리 모달에서 새 카테고리를 추가하거나, 기존 카테고리의 이름을 변경하거나 삭제할 수 있습니다.

3. **이미지 관리**
   - 개별 이미지 관리
     - 이미지 카드 클릭 시 상세 모달이 열려 더 큰 이미지와 메타데이터를 볼 수 있습니다.
     - 상세 모달에서 태그를 추가/삭제하거나, 카테고리를 할당/제거할 수 있습니다.
     - 다운로드, 커뮤니티 공유, 삭제 액션을 수행할 수 있습니다.
   - 일괄 이미지 관리
     - "선택 모드" 버튼을 클릭하여 다중 선택 모드로 전환합니다.
     - 이미지 카드의 체크박스를 통해 여러 이미지를 선택합니다.
     - 하단 도구바에서 선택된 이미지들에 대해 일괄 작업을 수행합니다.

4. **검색 및 필터링**
   - 검색: 이미지 이름, 프롬프트 텍스트, 태그 등으로 이미지를 검색할 수 있습니다.
   - 날짜 필터: 달력 UI를 통해 시작일과 종료일을 선택하여 특정 기간의 이미지만 표시합니다.
   - 태그 필터: 특정 태그가 포함된 이미지만 필터링하여 볼 수 있습니다.
   - 정렬: 최신순, 오래된순, 이름 알파벳순(A-Z, Z-A)으로 정렬할 수 있습니다.

5. **커뮤니티 공유**
   - 이미지 상세 모달에서 "커뮤니티 공유" 버튼을 클릭하여 공유 모달을 엽니다.
   - 제목(필수), 설명 입력 및 태그 관리 후 공유할 수 있습니다.
   - 전체 공개 또는 친구 공개 설정을 선택할 수 있습니다.
   - 공유 성공 시 성공 알림이 표시되고, 모달이 자동으로 닫힙니다.

#### 3. API 연동 (목업 구현)

1. **갤러리 이미지 목록 API**
   - **파일 위치**: `utils/api.ts`의 `getGalleryImages` 함수
   - **요청 매개변수**: `{ category?: string, search?: string, tags?: string[], sort?: string, dateFrom?: string, dateTo?: string }`
   - **응답 데이터**: `IGalleryImage[]`
   - **처리 로직**: 
     - 카테고리, 검색어, 태그, 날짜 범위로 필터링
     - 정렬 옵션에 따라 결과 정렬
     - 실제 API 호출을 시뮬레이션하기 위한 지연 추가 (600ms)

2. **카테고리 관리 API**
   - **파일 위치**: `app/gallery/page.tsx` 내 구현 로직
   - **HTTP 메서드**: 실제 구현 시 `GET`, `POST`, `PUT`, `DELETE` 방식 사용 예정
   - **API 세부 정보**:
    
    **카테고리 목록 조회**
    - 요청: 없음
    - 응답: `ICategory[]`
    - 로직: 사용자의 모든 카테고리 목록 반환
    
    **카테고리 생성**
    - 요청: `{ name: string }`
    - 응답: `{ success: boolean, category?: ICategory }`
    - 로직: 새 카테고리 생성 및 결과 반환
    
    **카테고리 수정**
    - 요청: `{ id: string, name: string }`
    - 응답: `{ success: boolean }`
    - 로직: 카테고리 이름 수정
    
    **카테고리 삭제**
    - 요청: `{ id: string }`
    - 응답: `{ success: boolean }`
    - 로직: 카테고리 삭제

3. **이미지 태그 관리 API**
   - **파일 위치**: `components/ImageDetailModal.tsx` 내 구현 로직
   - **HTTP 메서드**: 실제 구현 시 `PUT` 방식 사용 예정
   - **API 세부 정보**:
    
    **태그 업데이트**
    - 요청: `{ imageId: string, tags: string[] }`
    - 응답: `{ success: boolean, error?: { message: string } }`
    - 로직: 
      - 기존 이미지의 태그 목록을 새로운 태그 목록으로 교체
      - 태그 추가/제거는 모두 이 API를 통해 처리

4. **이미지 카테고리 이동 API**
   - **파일 위치**: `components/ImageDetailModal.tsx` 내 구현 로직
   - **HTTP 메서드**: 실제 구현 시 `PUT` 방식 사용 예정
   - **API 세부 정보**:
    
    **카테고리 업데이트**
    - 요청: `{ imageId: string, categoryId: string, isAdding: boolean }`
    - 응답: `{ success: boolean, error?: { message: string } }`
    - 로직: 
      - isAdding이 true인 경우 카테고리 추가
      - isAdding이 false인 경우 카테고리 제거

5. **이미지 삭제 API**
   - **파일 위치**: `utils/api.ts`의 `deleteGalleryImage` 함수
   - **HTTP 메서드**: 실제 구현 시 `DELETE` 방식 사용 예정
   - **API 세부 정보**:
    
    **이미지 삭제**
    - 요청: `{ imageId: string }`
    - 응답: `{ success: boolean, error?: { message: string } }`
    - 로직: 
      - 이미지 ID가 유효한지 확인
      - 삭제 성공 시 { success: true } 반환
      - 실패 시 오류 메시지 포함하여 반환
    
    **일괄 이미지 삭제**
    - 요청: `{ imageIds: string[] }`
    - 응답: `{ success: boolean, updatedCount: number, error?: { message: string } }`
    - 로직: 
      - 여러 이미지 ID에 대해 개별 삭제 수행
      - 성공적으로 삭제된 이미지 수 반환

6. **커뮤니티 공유 API**
   - **파일 위치**: `components/ShareModal.tsx` 내 구현 로직
   - **HTTP 메서드**: 실제 구현 시 `POST` 방식 사용 예정
   - **요청 데이터**: 
     ```typescript
     {
       imageId: string;
       title: string;
       description: string;
       tags: string[];
       isPublic: boolean;
     }
     ```
   - **응답 데이터**: 
     ```typescript
     boolean
     ```
   - **처리 로직**: 
     - 제목 필드 유효성 검사 (빈 값인 경우 오류)
     - 성공 시 true 반환, 실패 시 false 반환
     - 실제 구현 시에는 더 상세한 응답 데이터 제공 예정

#### 4. 테스트 항목

1. **갤러리 이미지 로딩 및 표시**
   - 페이지 초기 로딩 시 이미지가 올바르게 표시되는지 확인
   - 이미지 그리드가 반응형으로 조정되는지 확인
   - 이미지가 없을 때 빈 상태 UI가 올바르게 표시되는지 확인
   - 그리드/컴팩트 뷰 전환이 정상 작동하는지 확인

2. **카테고리 관리 기능**
   - 카테고리 선택 시 해당 카테고리 이미지만 필터링되는지 확인
   - 카테고리 생성/수정/삭제가 정상 작동하는지 확인
   - 새 카테고리 생성 후 UI에 즉시 반영되는지 확인
   - 보호된 카테고리(전체, 미분류)가 편집/삭제되지 않는지 확인

3. **이미지 상세 모달**
   - 모달 열기/닫기가 정상 작동하는지 확인
   - 이미지와 메타데이터가 올바르게 표시되는지 확인
   - 태그 추가/삭제가 정상 작동하는지 확인
   - 카테고리 할당/제거가 정상 작동하는지 확인
   - 다운로드/공유/삭제 기능이 정상 작동하는지 확인

4. **이미지 일괄 관리**
   - 선택 모드 전환이 정상 작동하는지 확인
   - 체크박스로 여러 이미지 선택이 정상 작동하는지 확인
   - 일괄 카테고리 이동이 정상 작동하는지 확인
   - 일괄 태그 추가가 정상 작동하는지 확인
   - 일괄 삭제가 정상 작동하는지 확인

5. **검색 및 필터링**
   - 검색 필드에 입력 시 결과가 정확히 필터링되는지 확인
   - 날짜 필터가 정상 작동하는지 확인
   - 태그 필터가 정상 작동하는지 확인
   - 정렬 옵션이 정상 작동하는지 확인
   - 여러 필터를 조합했을 때 올바른 결과가 표시되는지 확인

---

### 백엔드 기능명세서 (목업 API 구현)

#### 1. 갤러리 이미지 목록 API

- **파일 위치**: `utils/api.ts`의 `getGalleryImages` 함수
- **HTTP 메서드**: 실제 구현 시 `GET` 방식 사용 예정
- **요청 매개변수**: 
  ```typescript
  {
    category?: string;
    search?: string;
    tags?: string[];
    dateFrom?: string;
    dateTo?: string;
    sort?: 'newest' | 'oldest' | 'a-z' | 'z-a';
  }
  ```
- **응답 데이터**: 
  ```typescript
  IGalleryImage[]
  ```
- **처리 로직**: 
  - 현재는 `mockData.ts`에 정의된 갤러리 이미지 데이터를 필터링하여 반환
  - 카테고리, 검색어, 태그, 날짜 범위로 필터링
  - 정렬 옵션에 따라 결과 정렬
  - 실제 API 호출을 시뮬레이션하기 위한 지연 추가 (600ms)

#### 2. 카테고리 관리 API

- **파일 위치**: `app/gallery/page.tsx` 내 구현 로직
- **HTTP 메서드**: 실제 구현 시 `GET`, `POST`, `PUT`, `DELETE` 방식 사용 예정
- **API 세부 정보**:
  
  **카테고리 목록 조회**
  - 요청: 없음
  - 응답: `ICategory[]`
  - 로직: 사용자의 모든 카테고리 목록 반환
  
  **카테고리 생성**
  - 요청: `{ name: string }`
  - 응답: `{ success: boolean, category?: ICategory }`
  - 로직: 새 카테고리 생성 및 결과 반환
  
  **카테고리 수정**
  - 요청: `{ id: string, name: string }`
  - 응답: `{ success: boolean }`
  - 로직: 카테고리 이름 수정
  
  **카테고리 삭제**
  - 요청: `{ id: string }`
  - 응답: `{ success: boolean }`
  - 로직: 카테고리 삭제

#### 3. 이미지 태그 관리 API

- **파일 위치**: `components/ImageDetailModal.tsx` 내 구현 로직
- **HTTP 메서드**: 실제 구현 시 `PUT` 방식 사용 예정
- **API 세부 정보**:
  
  **태그 업데이트**
  - 요청: `{ imageId: string, tags: string[] }`
  - 응답: `{ success: boolean, error?: { message: string } }`
  - 로직: 
    - 기존 이미지의 태그 목록을 새로운 태그 목록으로 교체
    - 태그 추가/제거는 모두 이 API를 통해 처리

#### 4. 이미지 카테고리 이동 API

- **파일 위치**: `components/ImageDetailModal.tsx` 내 구현 로직
- **HTTP 메서드**: 실제 구현 시 `PUT` 방식 사용 예정
- **API 세부 정보**:
  
  **카테고리 업데이트**
  - 요청: `{ imageId: string, categoryId: string, isAdding: boolean }`
  - 응답: `{ success: boolean, error?: { message: string } }`
  - 로직: 
    - isAdding이 true인 경우 카테고리 추가
    - isAdding이 false인 경우 카테고리 제거

#### 5. 이미지 삭제 API

- **파일 위치**: `utils/api.ts`의 `deleteGalleryImage` 함수
- **HTTP 메서드**: 실제 구현 시 `DELETE` 방식 사용 예정
- **API 세부 정보**:
  
  **이미지 삭제**
  - 요청: `{ imageId: string }`
  - 응답: `{ success: boolean, error?: { message: string } }`
  - 로직: 
    - 이미지 ID가 유효한지 확인
    - 삭제 성공 시 { success: true } 반환
    - 실패 시 오류 메시지 포함하여 반환
  
  **일괄 이미지 삭제**
  - 요청: `{ imageIds: string[] }`
  - 응답: `{ success: boolean, updatedCount: number, error?: { message: string } }`
  - 로직: 
    - 여러 이미지 ID에 대해 개별 삭제 수행
    - 성공적으로 삭제된 이미지 수 반환

#### 6. 커뮤니티 공유 API

- **파일 위치**: `components/ShareModal.tsx` 내 구현 로직
- **HTTP 메서드**: 실제 구현 시 `POST` 방식 사용 예정
- **요청 데이터**: 
  ```typescript
  {
    imageId: string;
    title: string;
    description: string;
    tags: string[];
    isPublic: boolean;
  }
  ```
- **응답 데이터**: 
  ```typescript
  boolean
  ```
- **처리 로직**: 
  - 제목 필드 유효성 검사 (빈 값인 경우 오류)
  - 성공 시 true 반환, 실패 시 false 반환
  - 실제 구현 시에는 더 상세한 응답 데이터 제공 예정

#### 7. 테스트 항목

1. **API 응답 구조 검증**
   - 모든 API 응답이 일관된 구조를 따르는지 확인
   - 성공 응답에 필요한 데이터가 포함되어 있는지 확인
   - 오류 응답에 오류 정보가 제공되는지 확인

2. **API 응답 지연 시뮬레이션**
   - 각 API 함수에 적절한 지연 시간 설정
   - 프론트엔드 로딩 상태 처리가 올바르게 작동하는지 확인

3. **오류 처리 시뮬레이션**
   - 사용자 입력 유효성 검사 확인
   - 필수 필드 누락 시 명확한 오류 메시지 제공 확인

4. **데이터 일관성 확인**
   - 카테고리 변경, 태그 추가/삭제 후 목록 조회 시 상태가 일관되게 유지되는지 확인
   - 이미지 삭제 후 목록에서 적절히 제거되는지 확인

5. **실제 백엔드 연동 준비**
   - 모든 목업 API 함수가 실제 HTTP 요청으로 쉽게 전환 가능한지 확인
   - 요청/응답 데이터 형식이 백엔드 API와 호환되는지 검증
   - 인증 토큰 처리가 적절히 구현되어 있는지 확인
   - 페이지네이션, 필터링, 정렬 로직이 실제 데이터베이스 쿼리로 전환 가능한지 확인 