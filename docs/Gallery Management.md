## 갤러리 관리 및 커뮤니티 공유 화면 기능명세서

---

### 프론트엔드 기능명세서

#### 1. 화면 레이아웃 및 디자인 명세

- **파일 위치**: `app/gallery/page.tsx`

1. **갤러리 상단 섹션**
   - **UI 구성**: 상단에 배치된 갤러리 제목과 필터/정렬 컨트롤 영역으로, ShadCN의 `Typography` 및 `Select` 컴포넌트를 사용합니다.
   - **상호작용**: 필터 드롭다운에서 카테고리별, 날짜별 필터링 가능, 정렬 드롭다운에서 생성일, 이름 등으로 정렬 가능합니다.
   - **디자인**: 
     - 제목: 24pt Bold 텍스트로 "내 갤러리" 표시
     - 필터/정렬 컨트롤: 우측 정렬로 배치, 호버 시 테두리 색 강조(#4A90E2)

2. **카테고리 관리 섹션**
   - **UI 구성**: 갤러리 상단에 위치한 카테고리 관리 영역으로, 수평으로 나열된 탭 형태와 카테고리 추가 버튼을 포함합니다.
   - **상호작용**: 
     - 카테고리 탭 클릭 시 해당 카테고리의 이미지만 필터링하여 표시
     - '카테고리 추가' 버튼 클릭 시 모달 창이 열려 새 카테고리 생성 가능
   - **디자인**:
     - 카테고리 탭: ShadCN의 `Tabs` 컴포넌트 사용, 선택된 탭은 하단에 2px 메인 색상 밑줄 표시
     - 추가 버튼: 작은 '+' 아이콘 버튼, 호버 시 약간 확대(1.05배) 효과

3. **갤러리 그리드 영역**
   - **UI 구성**: 중앙 영역에 표시되는 이미지 그리드로, 반응형 그리드 레이아웃을 사용합니다.
   - **상호작용**:
     - 각 이미지 카드 호버 시 확대 효과와 오버레이 표시(이미지 정보 및 액션 버튼)
     - 이미지 클릭 시 상세 보기 모달 열림
     - 체크박스로 다중 선택 기능 지원
   - **디자인**:
     - 그리드: 화면 크기에 따라 3~5열로 자동 조정되는 반응형 그리드
     - 이미지 카드: 1:1 비율 썸네일, 그림자 효과(box-shadow: 0 4px 6px rgba(0,0,0,0.1))
     - 빈 상태: 이미지가 없을 경우 "아직 저장된 이미지가 없습니다" 메시지와 '이미지 생성하기' 버튼 표시

4. **이미지 상세 모달**
   - **파일 위치**: `components/ImageDetailModal.tsx`
   - **UI 구성**:
     - 모달 헤더: 이미지 제목과 닫기 버튼
     - 이미지 영역: 중앙에 큰 이미지 표시
     - 메타데이터 섹션: 생성일, 사용된 프롬프트, 스타일 옵션 정보
     - 태그 섹션: 적용된 태그 목록과, 태그 추가/삭제 기능
     - 액션 버튼: 커뮤니티 공유, 다운로드, 삭제 버튼
   - **상호작용**:
     - 태그 추가 입력 필드와 엔터키 또는 추가 버튼으로 새 태그 추가
     - 각 태그 옆의 'x' 버튼으로 태그 삭제
     - 공유 버튼 클릭 시 커뮤니티 공유 모달로 전환
   - **디자인**:
     - 모달 배경: 흰색(#FFFFFF)에 그림자 효과
     - 태그: 연한 파란색(#E6F0FD) 배경의 작은 뱃지 형태
     - 액션 버튼: 색상 구분(공유-메인 색상, 다운로드-회색, 삭제-빨간색)

5. **카테고리 관리 모달**
   - **파일 위치**: `components/CategoryModal.tsx`
   - **UI 구성**:
     - 모달 헤더: "카테고리 관리" 제목과 닫기 버튼
     - 카테고리 목록: 기존 카테고리 목록과 각각 편집/삭제 버튼
     - 새 카테고리 섹션: 카테고리명 입력 필드와 추가 버튼
   - **상호작용**:
     - 카테고리 추가: 이름 입력 후 추가 버튼 클릭
     - 카테고리 편집: 편집 아이콘 클릭 시 인라인 편집 모드 전환
     - 카테고리 삭제: 삭제 아이콘 클릭 시 확인 대화상자 표시 후 삭제
   - **디자인**:
     - 카테고리 항목: 각 항목 간 구분선으로 분리
     - 편집/삭제 버튼: 작은 아이콘 버튼으로 우측 정렬

6. **커뮤니티 공유 모달**
   - **파일 위치**: `components/ShareModal.tsx`
   - **UI 구성**:
     - 모달 헤더: "커뮤니티에 공유하기" 제목과 닫기 버튼
     - 이미지 미리보기: 상단에 작은 썸네일로 표시
     - 입력 필드: 제목, 설명, 태그 입력 영역
     - 공개 설정: 전체 공개/친구 공개 옵션 선택 라디오 버튼
     - 공유 버튼: 하단에 메인 색상의 큰 버튼
   - **상호작용**:
     - 자동 채우기: 갤러리 이미지의 태그가 자동으로 입력됨
     - 태그 관리: 엔터키 또는 쉼표로 태그 추가, 'x' 버튼으로 태그 삭제
     - 공유 버튼 클릭 시 API 호출 후 성공/실패 알림 표시
   - **디자인**:
     - 입력 필드: 테두리가 있는 깔끔한 디자인, 포커스 시 메인 색상 강조
     - 태그: 작은 뱃지 형태로 표시, 추가된 태그는 연한 파란색 배경
     - 공유 버튼: 메인 색상(#4A90E2) 배경에 흰색 텍스트

7. **일괄 관리 도구바**
   - **UI 구성**: 하나 이상의 이미지가 선택되면 화면 하단에 나타나는 도구바
   - **상호작용**:
     - 카테고리 이동: 선택된 이미지들을 특정 카테고리로 일괄 이동
     - 태그 추가: 선택된 이미지들에 동일한 태그 일괄 추가
     - 삭제: 선택된 이미지들 일괄 삭제
   - **디자인**:
     - 위치: 화면 하단 고정 위치, 약간의 위로 둥근 모서리
     - 배경: 짙은 회색(#333333)에 흰색 텍스트와 아이콘
     - 애니메이션: 선택 시 부드럽게 슬라이드 업 효과로 등장

#### 2. 사용자 흐름 및 상호작용

1. **갤러리 화면 진입**
   - 메인 화면의 네비게이션 메뉴에서 "내 갤러리" 링크를 클릭하여 진입합니다.
   - 페이지 로드 시 사용자의 저장된 이미지를 자동으로 불러와 그리드로 표시합니다.
   - 이미지 로딩 중에는 그리드 영역에 스켈레톤 로딩 UI가 표시됩니다.

2. **카테고리 관리**
   - 상단 탭에서 카테고리를 선택하여 해당 카테고리의 이미지만 필터링해 볼 수 있습니다.
   - "카테고리 추가" 버튼을 클릭하여 새 카테고리를 생성할 수 있습니다.
   - 카테고리 관리 모달에서 기존 카테고리의 이름을 변경하거나 삭제할 수 있습니다.

3. **이미지 관리**
   - 각 이미지 카드를 호버하면 오버레이가 표시되며, 체크박스로 선택 가능합니다.
   - 이미지 카드 클릭 시 상세 모달이 열려 더 큰 이미지와 메타데이터를 볼 수 있습니다.
   - 상세 모달에서 태그를 추가/삭제하거나, 커뮤니티 공유, 다운로드, 삭제 작업을 수행할 수 있습니다.

4. **일괄 관리**
   - 체크박스로 여러 이미지를 선택하면 하단에 도구바가 나타납니다.
   - 도구바에서 선택된 이미지들을 특정 카테고리로 이동하거나, 태그를 추가하거나, 일괄 삭제할 수 있습니다.
   - 일괄 삭제 시 확인 대화상자가 표시되며, 확인 후 삭제가 진행됩니다.

5. **커뮤니티 공유**
   - 이미지 상세 모달에서 "커뮤니티에 공유" 버튼을 클릭하면 공유 모달이 열립니다.
   - 공유 모달에서 제목, 설명을 입력하고 태그를 추가/편집한 후 공유할 수 있습니다.
   - 공유 성공 시 성공 알림이 표시되고, 공유 모달이 닫힙니다.

6. **검색 및 필터링**
   - 상단의 검색 필드를 통해 이미지 제목, 태그, 프롬프트 내용으로 이미지를 검색할 수 있습니다.
   - 필터 드롭다운에서 생성 날짜 범위 또는 태그로 이미지를 필터링할 수 있습니다.
   - 정렬 드롭다운에서 생성일, 제목 알파벳순으로 정렬할 수 있습니다.

#### 3. API 연동 (목업 구현)

1. **갤러리 이미지 목록 API**
   - **파일 위치**: `utils/api.ts`의 `fetchGalleryImages` 함수
   - **요청 매개변수**: `{ category?: string, filter?: object, sort?: string }`
   - **응답 데이터**: `{ success: boolean, data?: { images: IGalleryImage[] }, error?: { code: string, message: string } }`
   - **처리 로직**: 사용자의 저장된 이미지 목록을 반환, 카테고리/필터/정렬 옵션 적용

2. **카테고리 관리 API**
   - **파일 위치**: `utils/api.ts`의 `fetchCategories`, `createCategory`, `updateCategory`, `deleteCategory` 함수
   - **요청/응답 데이터**:
     - 카테고리 조회: `{}` → `{ categories: ICategory[] }`
     - 카테고리 생성: `{ name: string }` → `{ success: boolean, category?: ICategory }`
     - 카테고리 수정: `{ id: string, name: string }` → `{ success: boolean }`
     - 카테고리 삭제: `{ id: string }` → `{ success: boolean }`
   - **처리 로직**: 카테고리 CRUD 작업 처리

3. **이미지 태그 관리 API**
   - **파일 위치**: `utils/api.ts`의 `addImageTag`, `removeImageTag`, `bulkAddImageTags` 함수
   - **요청/응답 데이터**:
     - 태그 추가: `{ imageId: string, tag: string }` → `{ success: boolean }`
     - 태그 삭제: `{ imageId: string, tag: string }` → `{ success: boolean }`
     - 일괄 태그 추가: `{ imageIds: string[], tag: string }` → `{ success: boolean }`
   - **처리 로직**: 이미지에 태그 추가/삭제 및 여러 이미지에 동일 태그 일괄 추가

4. **이미지 카테고리 이동 API**
   - **파일 위치**: `utils/api.ts`의 `moveToCategory`, `bulkMoveToCategory` 함수
   - **요청/응답 데이터**:
     - 개별 이동: `{ imageId: string, categoryId: string }` → `{ success: boolean }`
     - 일괄 이동: `{ imageIds: string[], categoryId: string }` → `{ success: boolean }`
   - **처리 로직**: 이미지를 특정 카테고리로 이동하거나 여러 이미지를 일괄 이동

5. **이미지 삭제 API**
   - **파일 위치**: `utils/api.ts`의 `deleteImage`, `bulkDeleteImages` 함수
   - **요청/응답 데이터**:
     - 개별 삭제: `{ imageId: string }` → `{ success: boolean }`
     - 일괄 삭제: `{ imageIds: string[] }` → `{ success: boolean }`
   - **처리 로직**: 이미지 개별 삭제 또는 여러 이미지 일괄 삭제

6. **커뮤니티 공유 API**
   - **파일 위치**: `utils/api.ts`의 `shareToCommuity` 함수
   - **요청 데이터**: `{ imageId: string, title: string, description: string, tags: string[], isPublic: boolean }`
   - **응답 데이터**: `{ success: boolean, data?: { postId: string }, error?: { code: string, message: string } }`
   - **처리 로직**: 갤러리 이미지를 커뮤니티 게시물로 공유

#### 4. 테스트 항목

1. **갤러리 이미지 로딩 및 표시**
   - 페이지 초기 로딩 시 이미지가 올바르게 표시되는지 확인
   - 스켈레톤 로딩 UI가 적절히 표시되는지 확인
   - 이미지 그리드가 반응형으로 조정되는지 확인
   - 이미지가 없을 때 빈 상태 UI가 올바르게 표시되는지 확인

2. **카테고리 관리 기능**
   - 카테고리 탭 선택 시 해당 카테고리 이미지만 필터링되는지 확인
   - 카테고리 생성/수정/삭제가 정상 작동하는지 확인
   - 새 카테고리 생성 후 UI에 즉시 반영되는지 확인
   - 카테고리 삭제 시 확인 대화상자가 표시되고 삭제 후 UI가 업데이트되는지 확인

3. **이미지 상세 모달**
   - 모달 열기/닫기가 정상 작동하는지 확인
   - 이미지와 메타데이터가 올바르게 표시되는지 확인
   - 태그 추가/삭제가 정상 작동하는지 확인
   - 다운로드 기능이 정상 작동하는지 확인
   - 삭제 시 확인 대화상자가 표시되고 삭제 후 UI가 업데이트되는지 확인

4. **이미지 일괄 관리**
   - 체크박스로 여러 이미지 선택이 정상 작동하는지 확인
   - 선택 시 하단 도구바가 나타나는지 확인
   - 일괄 카테고리 이동이 정상 작동하는지 확인
   - 일괄 태그 추가가 정상 작동하는지 확인
   - 일괄 삭제가 정상 작동하는지 확인

5. **커뮤니티 공유 기능**
   - 공유 모달 열기/닫기가 정상 작동하는지 확인
   - 이미지 태그가 공유 모달에 자동으로 채워지는지 확인
   - 제목/설명 입력 및 태그 편집이 정상 작동하는지 확인
   - 공유 성공/실패 시 적절한 알림이 표시되는지 확인

6. **검색 및 필터링**
   - 검색 필드에 입력 시 실시간으로 결과가 필터링되는지 확인
   - 날짜 필터가 정상 작동하는지 확인
   - 태그 필터가 정상 작동하는지 확인
   - 정렬 옵션이 정상 작동하는지 확인
   - 필터 초기화 버튼이 정상 작동하는지 확인

---

### 백엔드 기능명세서 (목업 API 구현)

#### 1. 갤러리 이미지 목록 API

- **파일 위치**: `utils/api.ts`의 `fetchGalleryImages` 함수
- **HTTP 메서드**: 실제 구현 시 `GET` 방식 사용 예정
- **요청 매개변수**: 
  ```typescript
  {
    category?: string;
    search?: string;
    tags?: string[];
    dateFrom?: string;
    dateTo?: string;
    sort?: 'newest' | 'oldest' | 'name_asc' | 'name_desc';
    page?: number;
    limit?: number;
  }
  ```
- **응답 데이터**: 
  ```typescript
  {
    success: boolean;
    data?: {
      images: IGalleryImage[];
      total: number;
      page: number;
      pageSize: number;
    };
    error?: {
      code: string;
      message: string;
    }
  }
  ```
- **처리 로직**: 
  - 현재는 `mockData.ts`에 정의된 갤러리 이미지 데이터를 필터링하여 반환
  - 카테고리, 검색어, 태그, 날짜 범위로 필터링
  - 정렬 옵션에 따라 결과 정렬
  - 페이지네이션 적용하여 결과 제한

#### 2. 카테고리 관리 API

- **파일 위치**: `utils/api.ts`의 카테고리 관련 함수들
- **HTTP 메서드**: 실제 구현 시 `GET`, `POST`, `PUT`, `DELETE` 방식 사용 예정
- **API 세부 정보**:
  
  **카테고리 목록 조회**
  - 요청: 없음
  - 응답: `{ success: boolean, categories: ICategory[] }`
  - 로직: 사용자의 모든 카테고리 목록 반환
  
  **카테고리 생성**
  - 요청: `{ name: string }`
  - 응답: `{ success: boolean, category?: ICategory }`
  - 로직: 새 카테고리 생성 및 결과 반환, 중복 카테고리명 검사
  
  **카테고리 수정**
  - 요청: `{ id: string, name: string }`
  - 응답: `{ success: boolean }`
  - 로직: 카테고리 이름 수정, 존재하지 않는 ID 체크
  
  **카테고리 삭제**
  - 요청: `{ id: string }`
  - 응답: `{ success: boolean }`
  - 로직: 카테고리 삭제, 해당 카테고리의 이미지는 '미분류' 카테고리로 이동

#### 3. 이미지 태그 관리 API

- **파일 위치**: `utils/api.ts`의 태그 관련 함수들
- **HTTP 메서드**: 실제 구현 시 `POST`, `DELETE` 방식 사용 예정
- **API 세부 정보**:
  
  **태그 추가**
  - 요청: `{ imageId: string, tag: string }`
  - 응답: `{ success: boolean }`
  - 로직: 이미지에 태그 추가, 중복 태그 검사
  
  **태그 삭제**
  - 요청: `{ imageId: string, tag: string }`
  - 응답: `{ success: boolean }`
  - 로직: 이미지에서 태그 제거
  
  **일괄 태그 추가**
  - 요청: `{ imageIds: string[], tag: string }`
  - 응답: `{ success: boolean, updatedCount: number }`
  - 로직: 여러 이미지에 동일 태그 일괄 추가, 각 이미지별 중복 태그 검사

#### 4. 이미지 카테고리 이동 API

- **파일 위치**: `utils/api.ts`의 카테고리 이동 관련 함수들
- **HTTP 메서드**: 실제 구현 시 `PUT` 방식 사용 예정
- **API 세부 정보**:
  
  **개별 이미지 카테고리 이동**
  - 요청: `{ imageId: string, categoryId: string }`
  - 응답: `{ success: boolean }`
  - 로직: 이미지를 지정된 카테고리로 이동
  
  **일괄 카테고리 이동**
  - 요청: `{ imageIds: string[], categoryId: string }`
  - 응답: `{ success: boolean, updatedCount: number }`
  - 로직: 여러 이미지를 지정된 카테고리로 일괄 이동

#### 5. 이미지 삭제 API

- **파일 위치**: `utils/api.ts`의 삭제 관련 함수들
- **HTTP 메서드**: 실제 구현 시 `DELETE` 방식 사용 예정
- **API 세부 정보**:
  
  **이미지 삭제**
  - 요청: `{ imageId: string }`
  - 응답: `{ success: boolean }`
  - 로직: 단일 이미지 삭제, 관련 태그 및 메타데이터 함께 삭제
  
  **일괄 이미지 삭제**
  - 요청: `{ imageIds: string[] }`
  - 응답: `{ success: boolean, deletedCount: number }`
  - 로직: 여러 이미지 일괄 삭제, 관련 태그 및 메타데이터 함께 삭제

#### 6. 커뮤니티 공유 API

- **파일 위치**: `utils/api.ts`의 `shareToCommuity` 함수
- **HTTP 메서드**: 실제 구현 시 `POST` 방식 사용 예정
- **요청 데이터**: 
  ```typescript
  {
    imageId: string;
    title: string;
    description: string;
    tags: string[];
    isPublic: boolean;
  }
  ```
- **응답 데이터**: 
  ```typescript
  {
    success: boolean;
    data?: {
      postId: string;
    };
    error?: {
      code: string;
      message: string;
    }
  }
  ```
- **처리 로직**: 
  - 제목 필드 유효성 검사 (빈 값인 경우 오류)
  - 이미지 ID가 사용자의 갤러리에 있는지 확인
  - 커뮤니티 게시물 생성 및 이미지 정보 연결
  - 생성 성공 시 게시물 ID 반환

#### 7. 테스트 항목

1. **API 응답 구조 검증**
   - 모든 API 응답이 표준화된 구조를 따르는지 확인
   - 성공 응답에 필요한 데이터가 포함되어 있는지 확인
   - 오류 응답에 구체적인 오류 코드와 메시지가 제공되는지 확인

2. **API 응답 지연 시뮬레이션**
   - 각 API 함수에 300ms ~ 800ms 지연 시간 설정
   - 프론트엔드 로딩 상태 처리가 올바르게 작동하는지 확인

3. **오류 처리 시뮬레이션**
   - 존재하지 않는 이미지 ID에 대한 요청 처리 확인
   - 중복 카테고리명, 중복 태그 등의 예외 상황 처리 확인
   - 필수 필드 누락 시 명확한 오류 메시지 제공 확인

4. **데이터 일관성 확인**
   - 카테고리 변경, 태그 추가/삭제 후 목록 조회 시 상태가 일관되게 유지되는지 확인
   - 이미지 삭제 후 관련 태그 및 메타데이터가 함께 제거되는지 확인
   - 이미지 공유 시 갤러리 이미지와 게시물 간의 연결이 올바르게 설정되는지 확인

5. **실제 백엔드 연동 준비**
   - 모든 목업 API 함수가 실제 HTTP 요청으로 쉽게 전환 가능한지 확인
   - 요청/응답 데이터 형식이 일관되게 유지되는지 검증
   - 인증 토큰 처리가 적절히 구현되어 있는지 확인
   - 페이지네이션, 필터링, 정렬 로직이 실제 데이터베이스 쿼리로 전환 가능한지 확인 