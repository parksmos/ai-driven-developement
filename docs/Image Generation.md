## 이미지 생성 화면 기능명세서

---

### 프론트엔드 기능명세서

#### 1. 화면 레이아웃 및 디자인 명세

- **파일 위치**: `app/create/page.tsx`

1. **프롬프트 입력 필드**
   - **UI 구성**: 화면 상단에 배치된 넓은 텍스트 입력 필드로, ShadCN의 `Textarea` 컴포넌트를 사용해 사용자가 상세한 프롬프트를 입력할 수 있도록 합니다.
   - **상호작용**: 사용자가 텍스트를 입력하면 실시간으로 입력 길이가 표시되며, 최대 글자 수(500자)를 초과하지 않도록 제한합니다.
   - **오류 처리**: 프롬프트 필드가 비어 있을 경우 생성 버튼이 비활성화되며, 최소 10자 이상 입력하도록 안내 메시지가 표시됩니다.
   - **디자인**: 입력 필드에 "원하는 이미지를 자세히 설명해보세요..."와 같은 플레이스홀더 텍스트를 추가하고, 포커스 시 테두리 색이 메인 브랜드 색상(#4A90E2)으로 변경됩니다.

2. **스타일 옵션 선택 섹션**
   - **UI 구성**: 프롬프트 입력 필드 아래에 가로로 배치된 옵션 선택 영역으로, 다음 항목들을 포함합니다:
     - **색감 설정**: ShadCN의 `Select` 컴포넌트를 사용한 드롭다운 메뉴(밝은, 어두운, 비비드, 파스텔, 모노크롬 등)
     - **텍스처 설정**: `Select` 컴포넌트로 구현된 드롭다운 메뉴(부드러운, 거친, 매트, 광택 등)
     - **분위기 설정**: `Select` 컴포넌트로 구현된 드롭다운 메뉴(따뜻한, 차가운, 몽환적, 사실적 등)
     - **스타일 강도 조절**: `Slider` 컴포넌트를 사용한 슬라이더(0~100%)
   - **상호작용**: 각 옵션 변경 시 실시간으로 상태가 업데이트되며, 선택된 옵션은 시각적으로 강조됩니다.
   - **디자인**: 각 옵션 섹션은 구분선으로 분리되며, 옵션명은 16pt Semi-Bold 텍스트로 표시됩니다.

3. **이미지 생성 버튼**
   - **UI 구성**: 스타일 옵션 선택 섹션 하단에 배치된 큰 직사각형 버튼으로, ShadCN의 `Button` 컴포넌트를 사용합니다.
   - **상호작용**: 버튼 클릭 시 로딩 상태를 표시하며, 로딩 중에는 회전하는 스피너 아이콘과 함께 "이미지 생성 중..." 텍스트가 표시됩니다.
   - **활성화 조건**: 프롬프트가 최소 10자 이상 입력되었을 때만 버튼이 활성화됩니다.
   - **디자인**: 메인 브랜드 색상(#4A90E2)의 배경에 흰색 텍스트를 사용하며, 호버 시에는 약간 더 어두운 색상(#3A80D2)으로 변경됩니다.

4. **이미지 생성 결과 섹션**
   - **UI 구성**: 
     - 생성 전: 빈 영역에 이미지 아이콘과 "여기에 생성된 이미지가 표시됩니다" 텍스트가 표시됩니다.
     - 생성 중: 영역 중앙에 로딩 애니메이션(회전하는 아이콘)이 표시됩니다.
     - 생성 완료: 생성된 이미지가 표시되며, 하단에 갤러리 저장, 커뮤니티 공유, 다운로드 버튼이 나타납니다.
   - **상호작용**: 
     - 생성된 이미지를 클릭하면 원본 크기로 모달에서 확대 표시됩니다.
     - 다운로드 버튼을 통해 이미지를 직접 저장할 수 있습니다.
   - **디자인**: 생성된 이미지는 그림자 효과와 함께 표시되며, 호버 시 약간의 확대 효과(1.02배)가 적용됩니다.

5. **갤러리 저장, 커뮤니티 공유 및 다운로드 버튼**
   - **UI 구성**: 이미지 생성 결과 하단에 나란히 배치된 세 개의 버튼입니다.
     - 갤러리 저장 버튼: ShadCN의 `Button` 컴포넌트를 사용한 아웃라인 스타일 버튼
     - 커뮤니티 공유 버튼: ShadCN의 `Button` 컴포넌트를 사용한 채워진 스타일 버튼
     - 다운로드 버튼: ShadCN의 `Button` 컴포넌트를 사용한 아웃라인 또는 기본 스타일 버튼
   - **상호작용**:
     - 갤러리 저장 버튼 클릭 시 저장 성공 알림이 표시됩니다.
     - 커뮤니티 공유 버튼 클릭 시 공유 모달이 열립니다.
     - 다운로드 버튼 클릭 시 이미지 파일이 로컬 시스템에 저장되며, 다운로드 중에는 로딩 상태가 표시됩니다.
   - **디자인**: 
     - 갤러리 저장 버튼: 테두리만 있는 스타일로 메인 색상(#4A90E2) 사용
     - 커뮤니티 공유 버튼: 채워진 스타일로 메인 색상(#4A90E2) 배경과 흰색 텍스트 사용
     - 다운로드 버튼: 다운로드 중이 아닐 때는 기본 스타일, 다운로드 중에는 아웃라인 스타일로 변경되며 로딩 애니메이션 표시

6. **커뮤니티 공유 모달**
   - **파일 위치**: `components/ShareModal.tsx`
   - **UI 구성**:
     - 모달 헤더: 제목("커뮤니티에 공유하기")과 닫기 버튼
     - 제목 입력 필드: 게시물 제목 입력을 위한 텍스트 필드
     - 설명 입력 필드: 게시물 설명 입력을 위한 텍스트 영역
     - 태그 입력 필드: 태그 추가를 위한 입력 필드와 추가된 태그 표시 영역
     - 공개 설정: 전체 공개/친구 공개 선택 라디오 버튼
     - 공유 버튼: 하단에 배치된 제출 버튼
   - **상호작용**:
     - 태그 입력 후 엔터키 또는 쉼표로 태그 추가 가능
     - 추가된 태그는 뱃지 형태로 표시되며 각 태그 옆의 X 버튼으로 삭제 가능
     - 공유 버튼 클릭 시 로딩 상태 표시 후 성공/실패 알림 표시
   - **디자인**: 
     - 모달 배경은 흰색(#FFFFFF)
     - 태그 뱃지는 연한 파란색(#E6F0FD) 배경에 진한 파란색(#4A90E2) 텍스트
     - 공유 버튼은 메인 브랜드 색상(#4A90E2)의 배경에 흰색 텍스트

7. **알림 시스템 (Toast)**
   - **파일 위치**: `components/ui/toast.tsx`, `components/ui/use-toast.ts`, `components/ui/toaster.tsx`
   - **UI 구성**: ShadCN의 Toast 컴포넌트를 사용한 알림 시스템
     - 성공 알림: 녹색 테두리와 배경, 체크 아이콘이 포함된 토스트
     - 오류 알림: 빨간색 테두리와 배경, 경고 아이콘이 포함된 토스트
   - **상호작용**: 알림은 자동으로 일정 시간 후 사라지며, 사용자가 직접 닫을 수도 있습니다.
   - **디자인**: 화면 오른쪽 하단에 겹쳐서 표시되며, 애니메이션 효과와 함께 나타나고 사라집니다.

#### 2. 사용자 흐름 및 상호작용

1. **이미지 생성 화면 진입**
   - 메인 화면의 상단 네비게이션 메뉴에서 "이미지 생성" 링크를 클릭하여 진입합니다.
   - 페이지 로드 시 프롬프트 입력 필드에 자동으로 포커스가 이동합니다.
   - URL 매개변수로 프롬프트가 전달되면 입력 필드에 자동으로 채워집니다.

2. **프롬프트 입력 및 스타일 옵션 설정**
   - 사용자가 프롬프트 입력 필드에 원하는 이미지에 대한 설명을 입력합니다.
   - 원하는 스타일 옵션(색감, 텍스처, 분위기, 강도)을 선택합니다.
   - 모든 옵션은 기본값이 설정되어 있어 필수 선택은 아닙니다.

3. **이미지 생성 프로세스**
   - 사용자가 생성 버튼을 클릭하면 로딩 상태가 표시됩니다.
   - 로딩 중에는 프로그레스 애니메이션이 표시되며, 생성 중임을 알립니다.
   - 선택한 모든 스타일 옵션(색감, 텍스처, 분위기, 강도)이 API 호출에 포함되어 실제 이미지 생성에 반영됩니다.
   - 생성 완료 시 결과 영역에 생성된 이미지가 표시되며, 성공 알림이 나타납니다.

4. **이미지 저장 및 공유**
   - 생성된 이미지 아래에 표시되는 갤러리 저장 버튼을 클릭하여 개인 갤러리에 저장합니다.
   - 커뮤니티 공유 버튼을 클릭하여 공유 모달을 열고, 제목과 설명을 추가한 후 커뮤니티에 게시합니다.
   - 다운로드 버튼을 클릭하여 이미지를 로컬 시스템에 저장합니다.

5. **이미지 다운로드 프로세스**
   - 다운로드 버튼 클릭 시 버튼이 로딩 상태로 변경되고 다운로드가 시작됩니다.
   - 다운로드 중에는 "다운로드 중..." 메시지와 함께 로딩 애니메이션이 표시됩니다.
   - 다운로드 완료 시 성공 알림이 표시되고, 버튼은 다시 기본 상태로 돌아갑니다.
   - 다운로드 실패 시 오류 알림이 표시되고, 필요한 경우 대체 다운로드 방식으로 재시도합니다.

6. **추가 이미지 생성**
   - 이미지 생성 후 프롬프트와 스타일 옵션을 수정하여 새로운 이미지를 생성할 수 있습니다.
   - 이전 프롬프트는 유지되며, 사용자가 수정 가능합니다.

#### 3. API 연동 (목업 구현)

1. **이미지 생성 API**
   - **파일 위치**: `utils/api.ts`의 `generateImage` 함수
   - **요청 데이터**: `{ prompt: string, style: { color: string, texture: string, mood: string, intensity: number } }`
   - **응답 데이터**: `{ success: boolean, data?: { imageURL: string }, error?: { code: string, message: string } }`
   - **처리 로직**: 실제 API 대신 지연 시간 후 선택된 스타일에 맞는 이미지 URL 반환하도록 구현

2. **갤러리 저장 API**
   - **파일 위치**: `utils/api.ts`의 `saveToGallery` 함수
   - **요청 데이터**: `{ imageURL: string, prompt: string, style: object }`
   - **응답 데이터**: `{ success: boolean, data?: { imageId: string }, error?: { code: string, message: string } }`
   - **처리 로직**: 이미지 정보를 저장하고 성공 여부와 이미지 ID 반환

3. **커뮤니티 공유 API**
   - **파일 위치**: `utils/api.ts`의 `shareToCommuity` 함수
   - **요청 데이터**: `{ imageURL: string, prompt: string, style: object, title: string, description: string, tags: string[], isPublic: boolean }`
   - **응답 데이터**: `{ success: boolean, data?: { postId: string }, error?: { code: string, message: string } }`
   - **처리 로직**: 게시물 정보를 저장하고 성공 여부와 게시물 ID 반환

4. **다운로드 유틸리티 함수**
   - **파일 위치**: `utils/downloadImage.ts`
   - **주요 함수**: 
     - `downloadImage`: Fetch API를 사용하여 이미지를 Blob으로 변환 후 다운로드
     - `downloadImageWithCanvas`: Canvas API를 사용하여 CORS 제한이 있는 이미지를 다운로드
   - **처리 로직**: 
     - 이미지 URL을 받아서 로컬 시스템에 저장하는 기능 제공
     - 기본 다운로드 방식이 실패할 경우 Canvas를 사용한 백업 방식으로 전환
     - CORS 정책을 우회하여 다양한 소스의 이미지 다운로드 지원

#### 4. 테스트 항목

1. **프롬프트 입력 및 스타일 옵션 설정**
   - 프롬프트 입력 필드에 텍스트 입력이 정상적으로 동작하는지 확인
   - 최소 글자 수 미달 시 생성 버튼이 비활성화되는지 확인
   - 각 스타일 옵션이 정상적으로 선택 및 변경되는지 확인
   - URL 매개변수로 전달된 프롬프트가 올바르게 입력 필드에 설정되는지 확인

2. **이미지 생성 프로세스**
   - 생성 버튼 클릭 시 로딩 상태가 제대로 표시되는지 확인
   - 로딩 애니메이션이 정상적으로 작동하는지 확인
   - 이미지 생성 완료 후 결과가 적절히 표시되는지 확인
   - 성공 및 오류 알림이 적절한 시점에 표시되는지 확인

3. **이미지 상호작용**
   - 생성된 이미지 클릭 시 모달에서 확대 보기가 작동하는지 확인
   - 다운로드 버튼 클릭 시 이미지가 로컬에 저장되는지 확인
   - 다운로드 중 로딩 상태 표시가 제대로 동작하는지 확인
   - 다운로드 실패 시 대체 방식으로 전환되는지 확인

4. **저장 및 공유 기능**
   - 갤러리 저장 버튼 클릭 시 정상적으로 저장되는지 확인
   - 공유 모달이 정상적으로 열리고 닫히는지 확인
   - 태그 추가 및 삭제 기능이 정상 작동하는지 확인
   - 공유 버튼 클릭 시 게시물이 올바르게 생성되는지 확인

5. **알림 시스템**
   - ShadCN Toast 컴포넌트가 모든 상황에서 적절하게 표시되는지 확인
   - 성공 및 오류 알림이 시각적으로 구분되는지 확인
   - 알림이 자동으로 사라지는 타이밍이 적절한지 확인
   - 알림이 중첩되는 경우 올바르게 표시되는지 확인

6. **반응형 디자인**
   - 다양한 화면 크기에서 UI가 적절하게 조정되는지 확인
   - 모바일 환경에서 스타일 옵션 선택이 사용하기 편리한지 확인
   - 태블릿, 데스크톱 환경에서 모든 기능이 정상 작동하는지 확인

---

### 백엔드 기능명세서 (실제 API 구현)

#### 1. 이미지 생성 API

- **파일 위치**: 
  - 클라이언트: `utils/api.ts`의 `generateImage` 함수
  - 서버: `app/api/predictions/route.ts` 및 `app/api/predictions/[id]/route.ts`
- **HTTP 메서드**: `POST` 방식
- **요청 데이터**: 
  ```typescript
  {
    prompt: string;
    style: {
      color: string;
      texture: string;
      mood: string;
      intensity: number;
    }
  }
  ```
- **응답 데이터**: 
  ```typescript
  {
    success: boolean;
    data?: {
      imageURL: string;
    };
    error?: {
      code: string;
      message: string;
    }
  }
  ```
- **처리 로직**: 
  - **프롬프트 강화**: `enhancePromptWithStyle` 함수를 통해 사용자의 원본 프롬프트에 스타일 정보를 텍스트로 반영하여 강화
    - 색감 정보(bright, dark, vivid, pastel, monochrome 등)를 프롬프트에 추가
    - 텍스처 정보(smooth, rough, grainy, glossy 등)를 프롬프트에 추가
    - 분위기 정보(warm, cool, dreamlike, realistic 등)를 프롬프트에 추가
    - 강도에 따른 디테일 수준 정보를 프롬프트에 추가
  - **스타일 변환**: `mapStyleToFluxOptions` 함수를 통해 스타일 옵션을 Replicate Flux 모델 파라미터로 변환
    - 색감에 따라 적절한 aspect_ratio 설정(bright/vivid는 16:9, dark/monochrome는 1:1 등)
    - 텍스처에 따라 output_quality 설정(smooth 95%, rough 85%, grainy 80%, glossy 90%)
    - 분위기에 따라 일관된 이미지 생성을 위한 seed 값 설정 
    - 강도에 따라 num_inference_steps, megapixels, output_quality 조정
  - **API 호출**: Black Forest Labs의 Flux-Schnell 모델 API 호출
    - Replicate API를 통해 이미지 생성 요청 전송
    - 비동기 폴링을 통해 생성 결과 확인 및 이미지 URL 반환
- **오류 처리**: 
  - 프롬프트 길이 제한 (최소 10자 이상) 검증
  - API 키 누락 오류 처리
  - 모델 실행 오류 처리
  - 타임아웃 처리 (최대 60회 폴링, 2초 간격)
  - 오류 발생 시 구체적인 오류 코드와 메시지 반환

#### 2. 갤러리 저장 API

- **파일 위치**: `utils/api.ts`의 `saveToGallery` 함수
- **HTTP 메서드**: 실제 구현 시 `POST` 방식 사용 예정
- **요청 데이터**: `{ imageURL: string, prompt: string, style: object }`
- **응답 데이터**: `{ success: boolean, data?: { imageId: string }, error?: { code: string, message: string } }`
- **처리 로직**: 이미지 정보를 저장하고 성공 여부와 이미지 ID 반환
- **권한 처리**: 실제 구현 시 인증된 사용자만 갤러리에 저장 가능하도록 처리 예정

#### 3. 커뮤니티 공유 API

- **파일 위치**: `utils/api.ts`의 `shareToCommuity` 함수
- **HTTP 메서드**: 실제 구현 시 `POST` 방식 사용 예정
- **요청 데이터**: 
  ```typescript
  {
    imageURL: string;
    prompt: string;
    style: {
      color: string;
      texture: string;
      mood: string;
      intensity: number;
    };
    title: string;
    description: string;
    tags: string[];
    isPublic: boolean;
  }
  ```
- **응답 데이터**: 
  ```typescript
  {
    success: boolean;
    data?: {
      postId: string;
    };
    error?: {
      code: string;
      message: string;
    }
  }
  ```
- **처리 로직**: 
  - 현재는 공유 성공을 시뮬레이션하고 가상의 게시물 ID 반환
  - 제목 필드가 비어있는 경우 오류 응답 반환
  - 실제 구현 시 데이터베이스에 게시물 정보 저장 예정
- **권한 처리**: 실제 구현 시 인증된 사용자만 커뮤니티에 공유 가능하도록 처리 예정

#### 4. 이미지 다운로드 유틸리티

- **파일 위치**: `utils/downloadImage.ts`
- **주요 함수**: 
  - `downloadImage`: Fetch API를 사용하여 이미지를 다운로드하는 기본 함수
  - `downloadImageWithCanvas`: Canvas API를 사용하여 CORS 제한이 있는 이미지를 다운로드하는 백업 함수
- **처리 로직**:
  - Fetch API를 사용하여 이미지를 Blob으로 변환 후 다운로드
  - 이미지 URL에서 캐시 관련 매개변수 제거
  - MIME 타입을 'application/octet-stream'으로 설정하여 브라우저가 다운로드 동작을 수행하도록 강제
  - 기본 방식이 실패할 경우 Canvas를 사용한 대체 방식으로 시도

#### 5. 테스트 항목

1. **API 응답 구조 및 내용 검증**
   - 모든 API 응답이 표준화된 구조를 따르는지 확인
   - 성공 응답에 데이터 필드가 올바르게 포함되어 있는지 확인
   - 오류 응답에 오류 코드와 메시지가 적절하게 제공되는지 확인

2. **스타일 옵션 반영 검증**
   - 각 스타일 옵션(색감, 텍스처, 분위기, 강도)이 생성된 이미지에 적절히 반영되는지 확인
   - 스타일 옵션 값이 Replicate API 파라미터로 올바르게 변환되는지 확인
   - 강화된 프롬프트에 스타일 정보가 적절히 포함되는지 확인
   - 동일한 프롬프트와 다른 스타일 옵션으로 생성한 이미지 간의 차이 검증

3. **API 응답 지연 및 폴링 처리**
   - Replicate API의 비동기 처리 방식에 따른 폴링 메커니즘 검증
   - 폴링 중간에 오류 발생 시 적절히 처리되는지 확인
   - 프론트엔드 로딩 상태 표시가 폴링 과정 동안 유지되는지 확인
   - 긴 생성 시간에 대한 사용자 피드백 제공 여부 확인

4. **오류 처리 시뮬레이션**
   - 프롬프트 길이 제한 위반 시 적절한 오류 응답 반환
   - 필수 필드 누락 시 구체적인 오류 메시지 제공
   - 네트워크 오류 상황에 대한 처리 확인
   - 오류 메시지가 사용자 친화적인 형태로 표시되는지 확인

5. **이미지 다운로드 기능 테스트**
   - 다양한 이미지 소스에서 다운로드가 정상 작동하는지 확인
   - CORS 제한이 있는 이미지에 대한 대체 다운로드 방식 검증
   - 다운로드 실패 시 오류 처리가 적절히 이루어지는지 확인
   - 생성된 파일명이 고유하고 형식이 적절한지 확인

6. **실제 백엔드 연동 검증**
   - Replicate API 호출이 정상적으로 이루어지는지 확인
   - 환경 변수(REPLICATE_API_TOKEN)가 올바르게 설정되었는지 검증
   - API 호출 제한(rate limit)에 대한 처리가 구현되어 있는지 확인
   - 응답 데이터가 프론트엔드와 일관되게 통합되는지 검증 